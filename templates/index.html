<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AgenticFlow Moderation Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        function fillText(text) {
            document.querySelector("textarea[name='text']").value = text;
            hideWarning();
        }

        async function refreshSummary() {
            try {
                const res = await fetch("/summary");
                const html = await res.text();
                document.getElementById("summary").innerHTML = html;
            } catch (err) {
                console.error("Summary refresh failed:", err);
            }
        }

        // Auto-refresh every 10 seconds
        setInterval(refreshSummary, 10000);
        window.onload = refreshSummary;

        function clearText() {
            document.querySelector("textarea[name='text']").value = '';
            hideWarning();
        }

        function showWarning(msg) {
            const warningDiv = document.getElementById("warning-message");
            warningDiv.innerText = msg;
            warningDiv.style.display = "block";
        }

        function hideWarning() {
            const warningDiv = document.getElementById("warning-message");
            warningDiv.style.display = "none";
        }

        function validateForm() {
            const textarea = document.querySelector("textarea[name='text']");
            if (!textarea.value.trim()) {
                showWarning("‚ö†Ô∏è Please enter text before running moderation.");
                return false;
            }
            hideWarning();
            return true;
        }
    </script>
    <style>
        #warning-message {
            display: none;
            background-color: #ffecec;
            color: #d8000c;
            border: 1px solid #f5aca6;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <h1>ü§ñ AgenticFlow Moderation Dashboard</h1>

    <div id="summary">{{ summary_html | safe }}</div>

    <div class="demo">
        <h3>üß™ Try Demo Inputs</h3>

        <button class="allow"
            onclick="fillText('I really enjoyed this podcast episode! The discussion was thoughtful and respectful.')">
            ‚úÖ Allow
        </button>

        <button class="warn"
            onclick="fillText('What the hell is the speaker talking about?')">
            ‚ö†Ô∏è Warn
        </button>

        <button class="block"
            onclick="fillText('I hate this show; the host is so dumb and awful.')">
            ‚õî Block
        </button>
    </div>

    <!-- ‚ö†Ô∏è Inline Warning Message -->
    <div id="warning-message"></div>

    <form id="moderationForm" action="/moderate" method="post" onsubmit="return validateForm()">
        <textarea name="text" rows="6" placeholder="Enter text to moderate..."></textarea><br>
        <button type="submit">Run Moderation</button>
        <button type="button" onclick="clearText()">Clear</button>
    </form>

    {{ result_html | safe }}

    <div class="footer">
        AgenticFlow ¬© 2025 ‚Äî Autonomous Content Safety System
    </div>
</body>
</html>
